00068000003000022MonKey Bilanz Formular00001917.2.3 (Build 1726)000003002000009000026TEMPLATE Abschlagsrechnung000002-1000004true000004true00000100000010000000008786' -----------------------------------------------------------------------------------------'' Formular : TEMPLATE Abschlagsrechnung'' Historie' 15/12/2010: sts Initialversion' 27/05/2013: sts (Optionale Konstante zum Ausblenden der Steuerbereiche für die Ausgabe einer Kleinunternehmer-Rechnung)' 25/09/2013: sts (Texte angepasst)' 19/04/2016: sts (Definition der Summen-Variablen hinzugefügt)' 19/01/2017: sts (Alternierender Zeilenhintergrund hinzugefügt)' 01/06/2018: sts (Ausgabe Endbetrag, Anpassung Ausgabe für Abschlagsrechnungen bei einer stornierter Schlussrechnung)'' -----------------------------------------------------------------------------------------' Variablen- und Konstantendefinitionif ( not HasVariable("sumARBrutto") )dim sumARBrutto as numberendifif ( not HasVariable("sumARNetto") )dim sumARNetto as numberendifif ( not HasVariable("sumARSteuer") )dim sumARSteuer as numberendifif ( not HasVariable("steuersatz") )dim steuersatz as textendifif ( not HasVariable("row") )dim row as numberendifif ( not HasVariable("s1") )dim s1 as numberendifif ( not HasVariable("s2") )dim s2 as numberendifif ( not HasVariable("s3") )dim s3 as numberendifif ( not HasVariable("s4") )dim s4 as numberendifif ( not HasVariable("s5") )dim s5 as numberendifif ( not HasVariable("s6") )dim s6 as numberendifif ( not HasConstant("KLEINUNTERNEHMER") )const KLEINUNTERNEHMER as BOOLEAN = FALSEendifif ( not HasConstant("ALT_ZEILENHINTERGRUND") )const ALT_ZEILENHINTERGRUND as BOOLEAN = FALSEendif#BeginGraphicsTextif ( HasTable("Abschlagsrechnungen") )SetArea(350, AREA_AUTOSIZE)#include "STYLE Arial 9, normal"' Startwerte (X-Positionen) der Spalten in der Abschlagstabelle' Wichtig: Alle Koordinatenwerte im Dokument werden in Zehntel-Millimeter angegeben, Start ist oben links (0, 0)set anzahlSpalten to 5set s1 to LAYOUTLEFT               'Anfang Spalte Abschlagsrechnungif ( KLEINUNTERNEHMER )set s2 to LAYOUTLEFT + 1450    'Anfang Spalte Steuerset s3 to LAYOUTLEFT + 1450    'Anfang Spalte Gesamt Nettoset s4 to LAYOUTLEFT + 1450    'Anfang Spalte Steuerbetragelseset s2 to LAYOUTLEFT + 800     'Anfang Spalte Steuerset s3 to LAYOUTLEFT + 950     'Anfang Spalte Gesamt Nettoset s4 to LAYOUTLEFT + 1200    'Anfang Spalte Steuerbetragendifset s5 to LAYOUTLEFT + 1450        'Anfang Spalte Gesamt Bruttoset s6 to LAYOUTLEFT + LAYOUTWIDTH 'Ende Spalte Gesamt Brutto' Hier werden die Variablen für die Spaltenbreiten und Innenabstände der Positionstabelle initialisiert#include "TEMPLATE Table"endifset row to 0' -----------------------------------------------------------------------------------------' Tabelle Abschlagsrechnungen' -----------------------------------------------------------------------------------------#BeginTableHeaderif ( HasTable("Abschlagsrechnungen") )SetArea(220)#include "STYLE Arial 9, normal"set hoehe to 100set links1 to LAYOUTLEFTsetTextBold(true)if ( AUF_Art = AUFTRART_STORNO )DrawText("Berücksichtigte Abschlagsrechnungen" + IfThen(AUF_Vorbeleg <> "" and AUF_VorbelegNr <> "", " gemäß " + AUF_Vorbeleg + " Nr. " + AUF_VorbelegNr + " vom " + DateToText(AUF_VorbelegDatum), "") + ":", links1, hoehe, LAYOUTWIDTH, 50)elseDrawText("Abzgl. folgender Abschlagsrechnungen:", links1, hoehe, LAYOUTWIDTH, 50)endif#include "STYLE Arial 7, normal"set hoehe to hoehe + 80' SpaltenkopfDrawText("Bezeichnung", l1, hoehe, b1, 40)if ( not KLEINUNTERNEHMER )DrawText("USt", l2, hoehe, b2, 40)DrawText("Gesamt Netto" + aw, l3, hoehe, b3, 40, ALIGN_RIGHT)DrawText("Steuerbetrag"  + aw, l4, hoehe, b4, 40, ALIGN_RIGHT)endifDrawText("Gesamt Brutto" + aw, l5, hoehe, b5, 40, ALIGN_RIGHT)if ( not LINIEN_HORIZONTAL )DrawLine(s1, hoehe + 40, s6, hoehe + 40)endifSetCurrentTable("Abschlagsrechnungen")endif' -----------------------------------------------------------------------------------------' Der Bereich 'TabelRow' wird für jede Position einmal wiederholt#BeginTableRowif ( HasTable("Abschlagsrechnungen") )SetArea(MAX_POS_HEIGHT, AREA_AUTOSIZE)#include "STYLE Arial 8, normal"set hoehe to 0' Wechselnder Zeilenhintergrundif (ALT_ZEILENHINTERGRUND)SetFillColor(RGBColor(230, 230, 230))set row to row + 1if ( Mod(row, 2) = 1 )FillAreaVertical(LAYOUTLEFT, LAYOUTLEFT + LAYOUTWIDTH)endifendif' Tabellenränder links und rechtsif ( LINIEN_VERTIKAL )DrawVerticalLine(LAYOUTLEFT)DrawVerticalLine(LAYOUTLEFT + LAYOUTWIDTH)endifif ( LINIEN_HORIZONTAL )DrawLine(s1, hoehe, s6, hoehe)endifset steuersatz to Format(AUF_AR_SteuerProzent, "#.00") + "%"' Inhalt der Position' ---------------------------------------------------------------------DrawText("Abschlagsrechnung Nr. " + AUF_AR_AuftragsNr + " vom " + ShortDate(AUF_AR_Datum), l1, hoehe + 10, b1, 40)if ( not KLEINUNTERNEHMER )DrawText(steuersatz , l2, hoehe + 10, b2, 40)DrawText(Format(AUF_AR_GesamtNettoFW, FORMATBETRAGNULL), l3, hoehe + 10, b3, 40, ALIGN_RIGHT)set sumARNetto to sumARNetto + AUF_AR_GesamtNettoFWDrawText(Format(AUF_AR_GesamtSteuerFW, FORMATBETRAGNULL), l4, hoehe + 10, b4, 40, ALIGN_RIGHT)set sumARSteuer to sumARSteuer + AUF_AR_GesamtSteuerFWendifDrawText(Format(AUF_AR_GesamtBruttoFW, FORMATBETRAGNULL), l5, hoehe + 10, b5, 40, ALIGN_RIGHT)set sumARBrutto to sumARBrutto + AUF_AR_GesamtBruttoFW' Abstand zur nächsten Zeile vergrößern (weisse Linie als Platzhalter)SetLineColor(WHITE)DrawLine(s1, AREA_CURRENTHEIGHT + 10, s6, AREA_CURRENTHEIGHT + 10)SetLineColor(BLACK)endif' -----------------------------------------------------------------------------------------#BeginTableBreakif ( HasTable("Abschlagsrechnungen") )if ( AUF_Art <> AUFTRART_LIEFERSCHEIN and ZWISCHENSUMMEN )' Zwischensumme ausgebenSetArea(50)#include "STYLE Arial 8, normal"DrawLine(s1, 0, s6, 0)DrawText("Zwischensumme:", l1, 10, b1, 40)if ( not KLEINUNTERNEHMER )DrawText(Format(sumARNetto, FORMATBETRAGNULL), l3, 10, b3, 40, ALIGN_RIGHT)DrawText(Format(sumARSteuer, FORMATBETRAGNULL), l4, 10, b4, 40, ALIGN_RIGHT)endifDrawText(Format(sumARBrutto, FORMATBETRAGNULL), l5, 10, b5, 40, ALIGN_RIGHT)DrawLine(s1, 50, s6, 50)if ( LINIEN_VERTIKAL )DrawLine(LAYOUTLEFT, 0, LAYOUTLEFT, 50)DrawLine(LAYOUTLEFT + LAYOUTWIDTH, 0, LAYOUTLEFT + LAYOUTWIDTH, 50)endifelse' Abschließende Linie nach der letzten Position auf jeder SeiteSetArea(2)#include "STYLE Arial 8, normal"DrawLine(s1, 0, s6, 0)endifendif' -----------------------------------------------------------------------------------------' Gesamtbeträge am Tabellenende#BeginTableFooterif ( HasTable("Abschlagsrechnungen") )SetArea(600, AREA_AUTOSIZE)#include "STYLE Arial 8, normal"' Abschließende Linie nach der letzten Position der Tabelleif ( LINIEN_VERTIKAL )DrawLine(s1, 0, s6, 0)endifset hoehe to 0set links1 to LAYOUTLEFT + 1100set links2 to links1 + 300set breite to LAYOUTLEFT + LAYOUTWIDTH - links2 - 10DrawText("Summe aller Abschlagsrechnungen", l1, hoehe + 10, b1, 40)if ( not KLEINUNTERNEHMER )DrawText(Format(sumARNetto, FORMATBETRAGNULL), l3, hoehe + 10, b3, 40, ALIGN_RIGHT)DrawText(Format(sumARSteuer, FORMATBETRAGNULL), l4, hoehe + 10, b4, 40, ALIGN_RIGHT)endifDrawText(Format(sumARBrutto, FORMATBETRAGNULL), l5, hoehe + 10, b5, 40, ALIGN_RIGHT)DrawLine(s1, 50, s6, 50)if ( LINIEN_VERTIKAL )SetLineWidth(1)DrawLine(LAYOUTLEFT, 0, LAYOUTLEFT, AREA_CURRENTHEIGHT)DrawLine(LAYOUTLEFT + LAYOUTWIDTH, 0, LAYOUTLEFT + LAYOUTWIDTH, AREA_CURRENTHEIGHT)endifset hoehe to AREA_CURRENTHEIGHT + 40SetLineWidth(3)DrawLine(s1, hoehe, s6, hoehe)setTextBold(true)if ( AUF_Art = AUFTRART_STORNO )DrawText("Endbetrag Storno:", l1, hoehe + 10, b1, 40)elseDrawText("Endbetrag der Schlussrechnung:", l1, hoehe + 10, b1, 40)endifsetTextBold(false)if ( not KLEINUNTERNEHMER )DrawText(Ges_NettoBezeichnung + aw + ":", links1, hoehe + 10, links2 - links1, 40)DrawText(Format(Ges_mitAR_NettoBetragFW, FORMATBETRAGNULL), links2, hoehe + 10, breite, 40, ALIGN_RIGHT)set hoehe to AREA_CURRENTHEIGHTDrawText(Ges_SteuerBezeichnung + aw + ":", links1, hoehe + 10, links2 - links1, 40)DrawText(Format(Ges_mitAR_SteuerBetragFW, FORMATBETRAGNULL), links2, hoehe + 10, breite, 40, ALIGN_RIGHT)set hoehe to AREA_CURRENTHEIGHTendifsetTextBold(true)DrawText(Ges_BruttoBezeichnung + aw + ":", links1, hoehe + 10, links2 - links1, 40)DrawText(Format(Ges_mitAR_BruttoBetragFW, FORMATBETRAGNULL), links2, hoehe + 10, breite, 40, ALIGN_RIGHT)setTextBold(false)SetLineWidth(3)DrawLine(s1, AREA_CURRENTHEIGHT + 20, s6, AREA_CURRENTHEIGHT + 20)if ( LINIEN_VERTIKAL )SetLineWidth(1)DrawLine(LAYOUTLEFT, 90, LAYOUTLEFT, AREA_CURRENTHEIGHT)DrawLine(LAYOUTLEFT + LAYOUTWIDTH, 90, LAYOUTLEFT + LAYOUTWIDTH, AREA_CURRENTHEIGHT)endifendif0000011