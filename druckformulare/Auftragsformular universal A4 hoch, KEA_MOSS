00068000003000022MonKey Bilanz Formular00001917.2.3 (Build 1726)000003002000009000044Auftragsformular universal A4 hoch, KEA_MOSS0000041008000004true000004true00000100000010000129Auftragsformular universal, A4 hoch (Angebot, Auftragsbestätigung, Lieferschein, Rechnung und Gutschrift) für KEA/MOSS-Rechnungen024434' -----------------------------------------------------------------------------------------'' Formular : Auftragsformular universal A4 hoch, KEA_MOSS'' Historie' 19/12/2014: sts Initialversion' 10/02/2015: sts (Anpassung der Ausgabebreite für die Artikelbeschreibung bei Ausgabe ohne Artikelbilder)' 27/02/2015: sts (Konstante für STEUERFREI korrigiert)' 05/02/2016: sts (Ausgabehöhe bei Platzhalter nach den Positionen korrigiert)' 12/02/2016: sts (Ausgabe Zahlungsbedingung bei Korrekturrechnung)' 02/03/2016: sts (Ausgabe Artikelbild: Bildposition bei Artikeln ohne Beschreibung)' 19/04/2016: sts (Abschlagsrechnung: Definition der Summen-Variablen erfolgt jetzt im Template-Formular)' 22/07/2016: sts (Konstante FOOTER_HEIGHT geändert, Ausgabe Artikelbilder immer rechtsbündig)' 21/12/2016: hb  (Alternierender Zeilenhintergrund über Schalter "ALT_ZEILENHINTERGRUND" möglich)' 18/09/2017: sts (Anzeige Nachkommastellen für Einzelpreis laut REWE-Vorgaben)' 01/06/2018: sts (Anpassung Ausgabe für Abschlagsrechnungen bei einer stornierter Schlussrechnung)' 26/11/2019: sts (Ausgabe der Anrede nur wenn auch ein Kopftext enthalten ist)' 10/03/2020: sts (Ausgabe Sendungsnummer und Lieferart)'' -----------------------------------------------------------------------------------------#BeginDocumentSetDocument(150, 150, 100, 100) ' Seitenränder definieren' Konstanten definieren' Allgemeine Konstantenconst HEADER1_HEIGHT   as number = 360const HEADER2_HEIGHT   as number = 360const FOOTER_HEIGHT    as number = 250const BLACK            as color  = RGBColor(0,0,0)const WHITE            as color  = RGBColor(255,255,255)const RED              as color  = RGBColor(255,0,0)const LAYOUTLEFT       as number = 100const LAYOUTWIDTH      as number = 1700const MAX_POS_HEIGHT   as number = 2000const FORMATBETRAGNULL as text   = "-#,0.00"const FORMATEPNULL     as text   = "-#,0." + Left("0000", Firma_FakturaNKEP)const FORMATBETRAGLEER as text   = "#,0.00;-#,0.00;"const FORMATEPLEER     as text   = "#,0." + Left("0000", Firma_FakturaNKEP) + ";-#,0." + Left("0000", Firma_FakturaNKEP) + ";"const FORMATBETRAGGANZ as text   = "#,0;-#,0;"const FORMATKILONULL   as text   = "-#,0.000"const FORMATKILOLEER   as text   = "#,0.000;-#,0.000;"const SEP              as text   = " • "' Auftragsartenconst AUFTRART_ANGEBOT        as number = 1const AUFTRART_AUFTRAGSBEST   as number = 2const AUFTRART_LIEFERSCHEIN   as number = 3const AUFTRART_RECHNUNG       as number = 4const AUFTRART_ABSCHLAGSRECHN as number = 5const AUFTRART_KORREKTURRECHN as number = 6const AUFTRART_PROFORMA       as number = 7const AUFTRART_STORNO         as number = 8' Positionsartenconst AUFTRPOS_STAMMARTIKEL       as number = 1const AUFTRPOS_MANUELLARTIKEL     as number = 2const AUFTRPOS_TEXTPOSITION       as number = 3const AUFTRPOS_ZWISCHENSUMME      as number = 4const AUFTRPOS_SEITENUMBRUCH      as number = 5const AUFTRPOS_KOMMENTAR          as number = 6const AUFTRPOS_STAMMARTIKEL_ALT   as number = 7const AUFTRPOS_MANUELLARTIKEL_ALT as number = 8' Ausgabeartenconst AUSGABE_DRUCK               as number = 0const AUSGABE_EMAIL               as number = 1' Steuergebietconst INLAND                      as number = 1const EU_AUSLAND                  as number = 2const AUSLAND                     as number = 3const STEUERFREI                  as number = 4' ********************************************************************************' Über die folgenden Konstanten lässt sich die Darstellung in der Positionstabelle' anpassen (TRUE = Element sichtbar, FALSE = Element nicht sichtbar)const LINIEN_HORIZONTAL     as boolean = TRUEconst LINIEN_VERTIKAL       as boolean = TRUEconst ARTIKEL_NR            as boolean = TRUEconst ZWISCHENSUMMEN        as boolean = TRUEconst UEBERTRAG             as boolean = TRUEconst ARTIKEL_BILD          as boolean = FALSEconst ALT_ZEILENHINTERGRUND as boolean = FALSE' ********************************************************************************' ********************************************************************************'Alle Vorbelege anzeigen einschaltenconst VORBELEG_ALLE       as boolean = TRUE' ********************************************************************************' Variablen definierendim titel         as text = Case(AUF_Art = AUFTRART_ANGEBOT, "Angebot", AUF_Art = AUFTRART_AUFTRAGSBEST, "Auftragsbestätigung", AUF_Art = AUFTRART_LIEFERSCHEIN, "Lieferschein", AUF_Art = AUFTRART_RECHNUNG, "Rechnung", AUF_Art = AUFTRART_ABSCHLAGSRECHN, "Abschlagsrechnung", AUF_Art = AUFTRART_KORREKTURRECHN, "Korrekturrechnung", AUF_Art = AUFTRART_PROFORMA, "Proformarechnung", AUF_Art = AUFTRART_STORNO, "Storno", "")dim aw            as text = " " + AUF_WaehrungSymboldim stNr          as textdim abZ           as textdim fz1           as textdim fz2           as textdim fz3           as textdim fz4           as textdim hoehe         as numberdim links1        as numberdim links2        as numberdim breite        as numberdim zab           as numberdim steuer        as textdim steuersatz    as textdim altPos        as booleandim firstPos      as booleandim betrag        as textdim bezeichnung   as textdim zwischenSumme as numberdim anzVorbeleg   as numberdim posContentTop as numberdim row           as number = 0' Startwerte (X-Positionen) der Spalten in der Positionstabelle' Wichtig: Alle Koordinatenwerte im Dokument werden in Zehntel-Millimeter angegeben, Start ist oben links (0, 0)dim anzahlSpalten as number = 7dim s1 as number = LAYOUTLEFT               'Anfang Spalte Pos.dim s2 as number = LAYOUTLEFT + 70          'Anfang Spalte Bezeichnungdim s3 as number = LAYOUTLEFT + 900         'Anfang Spalte Mengedim s4 as number = LAYOUTLEFT + 1050        'Anfang Spalte Einh.dim s5 as number = LAYOUTLEFT + 1200        'Anfang Spalte Steuer (wird ausgeblendet)dim s6 as number = LAYOUTLEFT + 1200        'Anfang Spalte Einzelpreisdim s7 as number = LAYOUTLEFT + 1450        'Anfang Spalte Gesamtpreisdim s8 as number = LAYOUTLEFT + LAYOUTWIDTH 'Ende Spalte Gesamtpreis' Hier werden die Variablen für die Spaltenbreiten und Innenabstände der Positionstabelle initialisiert#include "TEMPLATE Table"' -----------------------------------------------------------------------------------------' Beginn Briefpapier (Hintergrund)' -----------------------------------------------------------------------------------------#BeginBackground' In diesem Script erfolgt die Definition des Briefpapiers inkl. Logoeinbindung#include "TEMPLATE Briefpapier A4 hoch"' -----------------------------------------------------------------------------------------' Beginn Kopfzeile (Platzhalter für nachfolgende Bereiche)' -----------------------------------------------------------------------------------------#BeginHeaderif ( PAGE_NUMBER = 1 )' Kopfzeile 1. SeiteSetArea(HEADER1_HEIGHT)else' Kopfzeile FolgeseitenSetArea(HEADER2_HEIGHT)endif#include "STYLE Arial 9, normal"' -----------------------------------------------------------------------------------------' Beginn Adress- und Infobereich' -----------------------------------------------------------------------------------------#BeginGraphicsTextSetArea(700, AREA_AUTOSIZE)#include "STYLE Arial 9, normal"set hoehe to 90' Adressfenster linksif ( AUF_Art = AUFTRART_LIEFERSCHEIN or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt = AUFTRART_LIEFERSCHEIN) and AUF_LieferanschriftVerwenden )DrawText(AUF_Lieferanschrift, links1, hoehe, 900, 250)elseDrawText(AUF_Rechnungsanschrift, links1, hoehe, 900, 250)endif' Infoblock rechtsset hoehe to 80set links1 to 1100set links2 to links1 + 280set breite to LAYOUTLEFT + LAYOUTWIDTH - links2set zab to 40if ( AUF_BestellNr <> "" )DrawText("Bestell-Nr.:", links1, hoehe, links2 - links1, 50)DrawText(AUF_BestellNr, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifDrawText("Kunden-Nr.:", links1, hoehe, links2 - links1, 50)DrawText(AUF_KundenNr, links2, hoehe, breite, 50)set hoehe to hoehe + zabif ( AUF_ADR_KundeExterneNr <> "" )DrawText("Ext. Referenz:", links1, hoehe, links2 - links1, 50)DrawText(AUF_ADR_KundeExterneNr, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( AUF_ADR_UStID <> "" )DrawText("Kunden-UStID:", links1, hoehe, links2 - links1, 50)DrawText(AUF_ADR_UStID, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifDrawText("Datum:", links1, hoehe, links2 - links1, 50)DrawText(IfThen(GetPlatform = 1, MediumDate(AUF_Datum), ShortDate(AUF_Datum)), links2, hoehe, breite, 50)set hoehe to hoehe + zabif ( AUF_Art = AUFTRART_RECHNUNG or AUF_Art = AUFTRART_ABSCHLAGSRECHN or AUF_Art = AUFTRART_KORREKTURRECHN or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt <> AUFTRART_LIEFERSCHEIN) and DateToNumber(AUF_LieferDatum) > 0 )DrawText("Lieferdatum:", links1, hoehe, links2 - links1, 50)DrawText(IfThen(GetPlatform = 1, MediumDate(AUF_LieferDatum), ShortDate(AUF_LieferDatum)), links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( AUF_VersandNummer <> "" )if ( AUF_Lieferart <> "" )DrawText("Lieferart:", links1, hoehe, links2 - links1, 50)DrawText(AUF_Lieferart, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifDrawText("Sendungsnummer:", links1, hoehe, links2 - links1, 50)DrawText(AUF_VersandNummer, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( AUF_BearbeiterAngeben )DrawText("Rückfragen an:", links1, hoehe, links2 - links1, 50)DrawText(AUF_Bearbeiter, links2, hoehe, breite, 50)set hoehe to hoehe + zabif ( AUF_BearbeiterTelefon <> "" )DrawText("Telefon:", links1, hoehe, links2 - links1, 50)DrawText(AUF_BearbeiterTelefon, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( AUF_BearbeiterEmail <> "" )DrawText("E-Mail:", links1, hoehe, links2 - links1, 50)DrawText(AUF_BearbeiterEmail, links2, hoehe, breite, 100)set hoehe to hoehe + 2 * zabendifelseif ( Firma_Telefon <> "" )DrawText("Telefon:", links1, hoehe, links2 - links1, 50)DrawText(Firma_Telefon, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( Firma_Email <> "" )DrawText("E-Mail:", links1, hoehe, links2 - links1, 50)DrawText(Firma_Email, links2, hoehe, breite, 100)set hoehe to hoehe + 2 * zabendifendifDrawText("Seite:", links1, hoehe, links2 - links1, 50)DrawText(NumToText(PAGE_NUMBER), links2, hoehe, breite, 50)' -----------------------------------------------------------------------------------------' Beginn Auftragskopf (Anrede, Anschreiben)' -----------------------------------------------------------------------------------------#BeginGraphicsTextSetArea(1500, AREA_AUTOSIZE)#include "STYLE Arial 9, normal"' Auftragstitelset hoehe to 100set links1 to LAYOUTLEFTSetTextSize(11)SetTextBold(true)DrawText(titel + " Nr. " + AUF_AuftragsNr, links1, hoehe, LAYOUTWIDTH, 50)SetTextBold(false)' Vorbelegif ( AUF_Vorbeleg <> "" AND AUF_VorbelegNr <> "" )set hoehe to AREA_CURRENTHEIGHTSetTextSize(7)set anzVorbeleg to CountFields(AUF_VorbelegInfo, Chr(13))if ( (not VORBELEG_ALLE) OR anzVorbeleg = 1 )' Nur den ersten Vorbeleg ausgebenDrawText("(Gehört zu " + AUF_Vorbeleg + " Nr. " + AUF_VorbelegNr + " vom " + DateToText(AUF_VorbelegDatum) + ")", links1, hoehe, LAYOUTWIDTH, 50)else' Alle Vorbelege ausgebenDrawText("(Gehört zu: " + ReplaceAll(AUF_VorbelegInfo, Chr(13), ", ") + ")", links1, hoehe, LAYOUTWIDTH, 300)endifendifSetTextSize(9)set hoehe to AREA_CURRENTHEIGHT + 80' Betreffif ( AUF_Betreff <> "" )DrawText(AUF_Betreff, links1, hoehe, LAYOUTWIDTH, 50)set hoehe to AREA_CURRENTHEIGHT + 40endif' Anrede und Kopftextif ( AUF_KopfText <> "" )if ( AUF_Anrede <> "" )DrawText(AUF_Anrede, links1, hoehe, LAYOUTWIDTH, 50)set hoehe to AREA_CURRENTHEIGHT + 40endifDrawText(AUF_KopfText, links1, hoehe, LAYOUTWIDTH, 1160)set hoehe to AREA_CURRENTHEIGHT + 40endif' -----------------------------------------------------------------------------------------' Positionstabelle' -----------------------------------------------------------------------------------------#BeginTableHeaderif ( HasTable("Positionen") )if ( PAGE_NUMBER > 1 and UEBERTRAG and AUF_Art <> AUFTRART_LIEFERSCHEIN and (AUF_Art <> AUFTRART_STORNO or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt <> AUFTRART_LIEFERSCHEIN)) )SetArea(130)elseSetArea(80)endif#include "STYLE Arial 7, normal"set hoehe to 40set firstPos to true' Spaltenkopfif ( AUF_Art = AUFTRART_LIEFERSCHEIN or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt = AUFTRART_LIEFERSCHEIN) )DrawText("Pos.", l1, hoehe, b1, 40)DrawText("Bezeichnung", l2, hoehe, b2, 40)DrawText("Menge", l3, hoehe, b3, 40, ALIGN_RIGHT)DrawText("Einh.", l4, hoehe, b4, 40)DrawText("Gewicht kg", l7, hoehe, b7, 40, ALIGN_RIGHT)elseDrawText("Pos.", l1, hoehe, b1, 40)DrawText("Bezeichnung", l2, hoehe, b2, 40)DrawText("Menge", l3, hoehe, b3, 40, ALIGN_RIGHT)DrawText("Einh.", l4, hoehe, b4, 40)DrawText("Einzelpreis" + aw, l6, hoehe, b6, 40, ALIGN_RIGHT)DrawText("Gesamtpreis" + aw, l7, hoehe, b7, 40, ALIGN_RIGHT)endifif ( not LINIEN_HORIZONTAL )DrawLine(s1, hoehe + 40, s8, hoehe + 40)endifSetCurrentTable("Positionen")' Übertrag' ---------------------------------------------------------------------if ( PAGE_NUMBER > 1 and UEBERTRAG and AUF_Art <> AUFTRART_LIEFERSCHEIN and (AUF_Art <> AUFTRART_STORNO or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt <> AUFTRART_LIEFERSCHEIN)) )#include "STYLE Arial 8, normal"if ( LINIEN_HORIZONTAL )DrawLine(s1, hoehe + 40, s8, hoehe + 40)endifset hoehe to AREA_CURRENTHEIGHTDrawText("Übertrag:", l5, hoehe + 10, l7 - l5, 40)if ( AUF_PreiseBrutto )' BruttopreiseDrawText(Format(zwischenSumme, FORMATBETRAGLEER), l7, hoehe + 10, b7, 40, ALIGN_RIGHT)else' NettopreiseDrawText(Format(zwischenSumme, FORMATBETRAGLEER), l7, hoehe + 10, b7, 40, ALIGN_RIGHT)endifset hoehe to AREA_CURRENTHEIGHT + 10' Tabellenränder links und rechtsif ( LINIEN_VERTIKAL )DrawLine(LAYOUTLEFT, 80, LAYOUTLEFT, hoehe)DrawLine(LAYOUTLEFT + LAYOUTWIDTH, 80, LAYOUTLEFT + LAYOUTWIDTH, hoehe)endifif ( not LINIEN_HORIZONTAL )DrawLine(s1, hoehe, s8, hoehe)endifendifendif' -----------------------------------------------------------------------------------------' Der Bereich 'TabelRow' wird für jede Position einmal wiederholt#BeginTableRowif ( HasTable("Positionen") )SetArea(MAX_POS_HEIGHT, AREA_AUTOSIZE)#include "STYLE Arial 8, normal"set hoehe to 0if (ALT_ZEILENHINTERGRUND)SetFillColor(RGBColor(230, 230, 230))set row to row + 1if ( Mod(row, 2) = 1 )FillAreaVertical(LAYOUTLEFT, LAYOUTLEFT + LAYOUTWIDTH)endifendif' Tabellenränder links und rechtsif ( LINIEN_VERTIKAL )DrawVerticalLine(LAYOUTLEFT)DrawVerticalLine(LAYOUTLEFT + LAYOUTWIDTH)endif' Bezeichnung für Steuer' ---------------------------------------------------------------------set steuersatz to Format(POS_SteuerProzent, "#.00") + "%"' Inhalt der Position' ---------------------------------------------------------------------set altPos to falseif ( POS_Art = AUFTRPOS_STAMMARTIKEL_ALT or POS_Art = AUFTRPOS_MANUELLARTIKEL_ALT )' Kennzeichen für Alternativpositionset altPos to trueSetTextItalic(true)endifif ( POS_Art = AUFTRPOS_STAMMARTIKEL or POS_Art = AUFTRPOS_MANUELLARTIKEL or altPos )' Obere horizntale Begrenzung bei ALternativpositionen einrückenif ( LINIEN_HORIZONTAL )if ( altPos and not firstPos )DrawLine(s2, hoehe, s5, hoehe)elseDrawLine(s1, hoehe, s8, hoehe)endifendifif ( POS_PosNrManuell <> "" )DrawText(POS_PosNrManuell, l1, hoehe + 10, b1, 40)elseif ( POS_Nummer <> 0 )DrawText(Format(POS_Nummer, "#"), l1, hoehe + 10, b1, 40)endifif ( altPos)DrawText("Alternativposition:", l2, hoehe + 10, b2, 40)set hoehe to hoehe + 40endifif ( ARTIKEL_NR )set bezeichnung to IfThen(POS_ArtikelNr = "", POS_Bezeichnung, POS_ArtikelNr + " / " + POS_Bezeichnung)elseset bezeichnung to POS_BezeichnungendifSetTextBold(true)DrawText(bezeichnung, l2, hoehe + 10, b2, 80)SetTextBold(false)set breite to IfThen(ARTIKEL_BILD and POS_Bild1 <> 0, 280, 20)set posContentTop to AREA_CURRENTHEIGHT + 10DrawText(POS_Beschreibung, l2, posContentTop, s5 - s2 - breite, MAX_POS_HEIGHT - 50)' Ausgabe von Artikelbilderif ( ARTIKEL_BILD )if ( LINIEN_VERTIKAL )DrawVerticalLine(s5)endifif (POS_Bild1 <> 0)DrawPicture("*" + NumToText(POS_Bild1), s5 - 220, posContentTop, 200, 200)endifendifif ( AUF_Art <> AUFTRART_LIEFERSCHEIN and (AUF_Art <> AUFTRART_STORNO or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt <> AUFTRART_LIEFERSCHEIN)) and POS_Rabatt <> 0 )DrawText("Rabatt %: " + Format(POS_Rabatt, "-#.00"), l5, hoehe + 50, s7 - s5 - 20, 40, ALIGN_RIGHT)endifDrawText(Format(POS_Menge, "-#." + Left("0000", Firma_FakturaNKMenge)), l3, hoehe + 10, b3, 40, ALIGN_RIGHT)DrawText(POS_Einheit, l4, hoehe + 10, b4, 40)if ( AUF_Art = AUFTRART_LIEFERSCHEIN or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt = AUFTRART_LIEFERSCHEIN) )DrawText(Format(POS_GesamtGewicht, FORMATKILOLEER), l7, hoehe + 10, b7, 40, ALIGN_RIGHT)elseif ( AUF_PreiseBrutto )' BruttopreiseDrawText(Format(POS_EinzelPreisBruttoFW, FORMATEPLEER), l6, hoehe + 10, b6, 40, ALIGN_RIGHT)set betrag to Format(POS_GesamtPreisBruttoFW, FORMATBETRAGLEER)set betrag to IfThen(altPos, "(" + betrag + ")", betrag)DrawText(betrag, l7, hoehe + 10, b7, 40, ALIGN_RIGHT)set zwischenSumme to zwischenSumme + IfThen(altPos, 0, POS_GesamtPreisBruttoFW)else' NettopreiseDrawText(Format(POS_EinzelPreisNettoFW, FORMATEPLEER), l6, hoehe + 10, b6, 40, ALIGN_RIGHT)set betrag to Format(POS_GesamtPreisNettoFW, FORMATBETRAGLEER)set betrag to IfThen(altPos, "(" + betrag + ")", betrag)DrawText(betrag, l7, hoehe + 10, b7, 40, ALIGN_RIGHT)set zwischenSumme to zwischenSumme + IfThen(altPos, 0, POS_GesamtPreisNettoFW)endifendif' ---------------------------------------------------------------------elseif ( POS_Art = AUFTRPOS_TEXTPOSITION )if ( LINIEN_HORIZONTAL and (POS_Bezeichnung <> "" or POS_Beschreibung <> "") )DrawLine(s1, hoehe, s8, hoehe)endifif ( POS_Bezeichnung = "" )if ( POS_Beschreibung <> "" )DrawText(POS_Beschreibung, l2, hoehe + 10, s7 - s2 - 20, MAX_POS_HEIGHT - 50)else' Abstand zur nächsten Zeile vergrößern (weisse Linie als Platzhalter)SetLineColor(WHITE)DrawLine(s1, hoehe + 10, s8, hoehe + 10)SetLineColor(BLACK)endifelseSetTextBold(true)DrawText(POS_Bezeichnung, l2, hoehe + 10, b2, 80)SetTextBold(false)DrawText(POS_Beschreibung, l2, AREA_CURRENTHEIGHT + 10, s7 - s2 - 20, MAX_POS_HEIGHT - 50)endif' ---------------------------------------------------------------------elseif ( AUF_Art <> AUFTRART_LIEFERSCHEIN and (AUF_Art <> AUFTRART_STORNO or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt <> AUFTRART_LIEFERSCHEIN)) and POS_Art = AUFTRPOS_ZWISCHENSUMME )if ( LINIEN_HORIZONTAL )DrawLine(s1, hoehe, s8, hoehe)endifSetTextBold(true)DrawText(IfThen(POS_Bezeichnung = "", "Zwischensumme", POS_Bezeichnung), l2, hoehe + 10, b2, 80)SetTextBold(false)if ( POS_Beschreibung <> "" )DrawText(POS_Beschreibung, l2, AREA_CURRENTHEIGHT + 10, s7 - s2 - 20, MAX_POS_HEIGHT - 50)endifif ( AUF_PreiseBrutto )' BruttopreiseDrawText(Format(POS_GesamtPreisBruttoFW, FORMATBETRAGLEER), l7, hoehe + 10, b7, 40, ALIGN_RIGHT)else' NettopreiseDrawText(Format(POS_GesamtPreisNettoFW, FORMATBETRAGLEER), l7, hoehe + 10, b7, 40, ALIGN_RIGHT)endifSetTextBold(false)' ---------------------------------------------------------------------elseif ( POS_Art = AUFTRPOS_SEITENUMBRUCH )PageBreak' ---------------------------------------------------------------------elseif ( POS_Art = AUFTRPOS_KOMMENTAR )' Kommentarpositionen werden nicht ausgedrucktendifif ( POS_Art <> AUFTRPOS_KOMMENTAR and POS_Art <> AUFTRPOS_SEITENUMBRUCH )' Abstand zur nächsten Zeile vergrößern (weisse Linie als Platzhalter)set hoehe to IfThen(POS_Art = AUFTRPOS_ZWISCHENSUMME AND AUF_Art = AUFTRART_LIEFERSCHEIN, 0, AREA_CURRENTHEIGHT + 10)SetLineColor(WHITE)DrawLine(s1, hoehe, s8, hoehe)SetLineColor(BLACK)endifset firstPos to falseendif' -----------------------------------------------------------------------------------------#BeginTableBreakif ( HasTable("Positionen") )if ( AUF_Art <> AUFTRART_LIEFERSCHEIN and (AUF_Art <> AUFTRART_STORNO or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt <> AUFTRART_LIEFERSCHEIN)) and ZWISCHENSUMMEN )' Zwischensumme ausgebenSetArea(50)#include "STYLE Arial 8, normal"DrawLine(s1, 0, s8, 0)DrawText("Zwischensumme:", l5, 10, l7 - l5, 40)DrawText(Format(zwischenSumme, FORMATBETRAGLEER), l7, 10, b7, 40, ALIGN_RIGHT)DrawLine(s1, 50, s8, 50)if ( LINIEN_VERTIKAL )DrawLine(LAYOUTLEFT, 0, LAYOUTLEFT, 50)DrawLine(LAYOUTLEFT + LAYOUTWIDTH, 0, LAYOUTLEFT + LAYOUTWIDTH, 50)endifelse' Abschließende Linie nach der letzten Position auf jeder SeiteSetArea(2)#include "STYLE Arial 8, normal"DrawLine(s1, 0, s8, 0)endifendif' -----------------------------------------------------------------------------------------' Gesamtbeträge am Tabellenende#BeginTableFooterif ( HasTable("Positionen") )SetArea(600, AREA_AUTOSIZE)#include "STYLE Arial 8, normal"' Abschließende Linie nach der letzten Position der Tabelleif ( LINIEN_VERTIKAL )DrawLine(s1, 0, s8, 0)endifset hoehe to 50set links1 to LAYOUTLEFT + 1100set links2 to links1 + 300set breite to LAYOUTLEFT + LAYOUTWIDTH - links2 - 10if ( AUF_Art = AUFTRART_LIEFERSCHEIN or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt = AUFTRART_LIEFERSCHEIN) )' Gesamtgewicht für LieferscheinSetTextBold(true)DrawText("Gesamtgewicht:", links1, hoehe + 10, links2 - links1, 40)DrawText(Format(AUF_Gewicht, FORMATKILONULL), links2, hoehe + 10, breite, 40, ALIGN_RIGHT)set hoehe to AREA_CURRENTHEIGHTelseif ( Ges_RabattBetragFW <> 0 )' Gesamtzeile für alle anderen Auftragsarten' Gesamt Rabatt vorhandenSetTextColor(RED)DrawText("Gesamtrabatt an dieser Stelle nicht möglich!", LAYOUTLEFT, hoehe + 10, LAYOUTWIDTH, 40, ALIGN_CENTER)SetTextColor(BLACK)else' Gesamt BruttoSetTextBold(true)DrawText(Ges_BruttoBezeichnung + aw + ":", links1, hoehe + 10, links2 - links1, 40)DrawText(Format(Ges_BruttoBetragFW, FORMATBETRAGNULL), links2, hoehe + 10, breite, 40, ALIGN_RIGHT)SetTextBold(false)endifendifSetLineWidth(3)DrawLine(s1, 40, s8, 40)DrawLine(s1, AREA_CURRENTHEIGHT + 20, s8, AREA_CURRENTHEIGHT + 20)if ( LINIEN_VERTIKAL )SetLineWidth(1)DrawLine(LAYOUTLEFT, 40, LAYOUTLEFT, AREA_CURRENTHEIGHT)DrawLine(LAYOUTLEFT + LAYOUTWIDTH, 40, LAYOUTLEFT + LAYOUTWIDTH, AREA_CURRENTHEIGHT)endifendif' -----------------------------------------------------------------------------------------' Abschlagsrechnungen (geleistete Anzahlungen)' -----------------------------------------------------------------------------------------#include "TEMPLATE Abschlagsrechnung"' -----------------------------------------------------------------------------------------' Fussbereich' -----------------------------------------------------------------------------------------' Zahlungstext#BeginGraphicsTextSetArea(300, AREA_AUTOSIZE)if ( AUF_Art <> AUFTRART_LIEFERSCHEIN and (AUF_Art <> AUFTRART_STORNO or (AUF_Art = AUFTRART_STORNO and AUF_VorbelegArt <> AUFTRART_LIEFERSCHEIN)) and AUF_ZahlungsText <> "" )#include "STYLE Arial 9, normal"set hoehe to 50set breite to LAYOUTWIDTHset links1 to LAYOUTLEFTSetTextBold(FALSE)DrawText(AUF_ZahlungsText, links1, hoehe, breite, 250)endif' Fusstext#BeginGraphicsTextSetArea(1300, AREA_AUTOSIZE)if ( AUF_Fusstext <> "" )#include "STYLE Arial 9, normal"set hoehe to 50set breite to LAYOUTWIDTHset links1 to LAYOUTLEFTDrawText(AUF_Fusstext, links1, hoehe, breite, 1250)endif' Grusstext#BeginGraphicsTextSetArea(350, AREA_AUTOSIZE)#include "STYLE Arial 9, normal"set hoehe to 50set breite to LAYOUTWIDTHset links1 to LAYOUTLEFTif ( AUF_Grussformel <> "" )DrawText(AUF_Grussformel, links1, hoehe, breite, 300)elseif ( AUF_BearbeiterAngeben AND AUF_BearbeiterSignaturText <> "" )DrawText(AUF_BearbeiterSignaturText, links1, hoehe, breite, 300)endifendif' -----------------------------------------------------------------------------------------' Beginn Fusszeile (Platzhalter)' -----------------------------------------------------------------------------------------#BeginFooterSetArea(FOOTER_HEIGHT)#include "STYLE Arial 9, normal"0000011