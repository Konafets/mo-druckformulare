00068000003000022MonKey Bilanz Formular00001917.2.3 (Build 1726)000003002000009000025Mahnung universal A4 hoch0000042018000004true000004true00000100000010000045Mahnung für Mahnstufe 1-4, universal, A4 hoch011871' -----------------------------------------------------------------------------------------'' Formular  : Mahnung im Format A4 hoch' Historie  : 01/09/2008 Initialversion at' Geändert  : 21/07/2010 sts: (Infoblock rechts - Breitenanpassung des Datenbereiches, dadurch mehr nutzbarer Platz)' Geändert  : 23/09/2012: sts (Konstante für Ausgabeform Druck oder Email)' Geändert  : 19/04/2013: mm (Mahntitel und Mahntexte sind nicht mehr im Formular hinterlegt, sondern werden aus den FIBU-Vorgaben übernommen)' Geändert  : 24/06/2014: sts (Ausgabe Stichtagdatum im Mahntext)' Geändert  : 01/07/2016: sts (Textzuweisung für mahntext2 im Formular: Ausgabe mit Stichtagdatum, Ausgabe des originalen Rechnungsbetrags)' Geändert  : 22/07/2016: sts (Konstante FOOTER_HEIGHT geändert)' Geändert  : 21.12.2016: hb  (Alternierender Zeilenhintergrund über Schalter "ALT_ZEILENHINTERGRUND" möglich)'' -----------------------------------------------------------------------------------------#BeginDocumentSetDocument(150, 150, 100, 100) ' Seitenränder definieren' Konstanten definieren' Allgemeine Konstantenconst HEADER1_HEIGHT   as number = 360const HEADER2_HEIGHT   as number = 360const FOOTER_HEIGHT    as number = 250const BLACK            as color  = RGBColor(0,0,0)const WHITE            as color  = RGBColor(255,255,255)const LAYOUTLEFT       as number = 100const LAYOUTWIDTH      as number = 1700const FORMATBETRAGNULL as text   = "-#,0.00"const FORMATBETRAGLEER as text   = "#,0.00;-#,0.00;"const SEP              as text   = " • "const CR               as text   = Chr(13)' Rechnungsartenconst ART_RECHNUNG     as number = 0const ART_GUTSCHRIFT   as number = 1' Ausgabeartenconst AUSGABE_DRUCK    as number = 0const AUSGABE_EMAIL    as number = 1' ********************************************************************************' Über die folgenden Konstante lässt sich die Darstellung einer alternierenden' Hintergrundfarbe einstellen (TRUE = Element sichtbar, FALSE = Element nicht sichtbar)const ALT_ZEILENHINTERGRUND as boolean = FALSE' ********************************************************************************' Variablen definierendim aw        as text = " " + FILTER_Waehrungdim abZ       as textdim fz1       as textdim fz2       as textdim fz3       as textdim fz4       as textdim stNr      as textdim hoehe     as numberdim links1    as numberdim links2    as numberdim breite    as numberdim zab       as numberdim mahntitel as textdim mahntext1 as textdim mahntext2 as textdim gesamt    as numberdim row       as number = 0' Mahntexte definierenset mahntitel to MA_MahntextTitelset mahntext1 to MA_MahntextKopfset mahntext2 to MA_MahntextFussif ( mahntitel = "" )set mahntitel to "Mahnung"endifif ( mahntext1 = "" )set mahntext1 to "für die unten aufgeführte(n) Rechnung(en) konnten wir leider noch keinen Zahlungseingang feststellen:"endifif ( mahntext2 = "" )set mahntext2 to "Zahlungseingänge wurden bis zum " + IfThen(GetPlatform = 1, MediumDate(FILTER_Stichtag), ShortDate(FILTER_Stichtag)) + " berücksichtigt." + CR + CRset mahntext2 to mahntext2 + "Wenn Sie bereits gezahlt haben, bitten wir um eine kurze Nachricht,"set mahntext2 to mahntext2 + " wann, auf welches Konto und unter welchem Namen Sie an uns überwiesen haben."set mahntext2 to mahntext2 + " Damit können Sie dieses Schreiben als gegenstandslos betrachten." + CR + CRset mahntext2 to mahntext2 + "Falls Sie noch nicht gezahlt haben, so bitten wir um eine rasche Erledigung."set mahntext2 to mahntext2 + CR + CR + CR + "Mit freundlichen Grüßen" + CR + CRset mahntext2 to mahntext2 + Firma_Name + CR + "Buchhaltung"endif' Startwerte (X-Positionen) der Spalten in der Positionstabelle' Wichtig: Alle Koordinatenwerte im Dokument werden in Zehntel-Millimeter angegeben, Start ist oben links (0, 0)dim anzahlSpalten as number = 9dim s1 as number  = LAYOUTLEFT                  ' Anfang Spalte Beleg-Nrdim s2 as number  = LAYOUTLEFT + 250            ' Anfang Spalte Datumdim s3 as number  = LAYOUTLEFT + 430            ' Anfang Spalte Fälligdim s4 as number  = LAYOUTLEFT + 610            ' Anfang Spalte Mahnstufedim s5 as number  = LAYOUTLEFT + 730            ' Anfang Spalte Rechnungsbetragdim s6 as number  = LAYOUTLEFT + 950            ' Anfang Spalte Offendim s7 as number  = LAYOUTLEFT + 1150           ' Anfang Spalte Gebührendim s8 as number  = LAYOUTLEFT + 1350           ' Anfang Spalte Zinsendim s9 as number  = LAYOUTLEFT + 1520           ' Anfang Spalte Gesamt Offendim s10 as number = LAYOUTLEFT + LAYOUTWIDTH    ' Ende Tabelle' Hier werden die Variablen für die Spaltenbreiten und Innenabstände der Positionstabelle initialisiert#include "TEMPLATE Table"' -----------------------------------------------------------------------------------------' Beginn Briefpapier (Hintergrund)' -----------------------------------------------------------------------------------------#BeginBackground' In diesem Script erfolgt die Definition des Briefpapiers inkl. Logoeinbindung#include "TEMPLATE Briefpapier A4 hoch"' -----------------------------------------------------------------------------------------' Beginn Kopfzeile (Platzhalter für nachfolgende Bereiche)' -----------------------------------------------------------------------------------------#BeginHeaderif ( PAGE_NUMBER = 1 )' Kopfzeile 1. SeiteSetArea(HEADER1_HEIGHT)else' Kopfzeile FolgeseitenSetArea(HEADER2_HEIGHT)endif' Dummy-Zeichenbefehl (unsichtbar): Ohne Ausgabe wird die Bereichshöhe nicht gesetztDrawLine(0, 0, 0, 0)' -----------------------------------------------------------------------------------------' Adress- und Infobereich' -----------------------------------------------------------------------------------------#BeginGraphicsTextSetArea(700, AREA_AUTOSIZE)#include "STYLE Arial 9, normal"set hoehe to 90' Adressfenster linksDrawText(ADR_Anschrift, links1, hoehe, 900, 250)' Infoblock rechtsset hoehe to 80set links1 to 1100set links2 to links1 + 280set breite to LAYOUTLEFT + LAYOUTWIDTH - links2set zab to 40DrawText("Kunden-Nr.:", links1, hoehe, links2 - links1, 50)DrawText(ADR_KundenNr, links2, hoehe, breite, 50)set hoehe to hoehe + zabDrawText("Debitor.:", links1, hoehe, links2 - links1, 50)DrawText(Format(ADR_DebiKonto, "00000"), links2, hoehe, breite, 50)set hoehe to hoehe + zabif ( ADR_ExterneNr <> "" )DrawText("Ext. Referenz:", links1, hoehe, links2 - links1, 50)DrawText(ADR_ExterneNr, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( ADR_UStID <> "" )DrawText("Kunden-UStID:", links1, hoehe, links2 - links1, 50)DrawText(ADR_UStID, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifDrawText("Datum:", links1, hoehe, links2 - links1, 50)DrawText(IfThen(GetPlatform = 1, MediumDate(GetCurrentDate), ShortDate(GetCurrentDate)), links2, hoehe, breite, 50)set hoehe to hoehe + zabif ( Firma_Telefon <> "" )DrawText("Telefon:", links1, hoehe, links2 - links1, 50)DrawText(Firma_Telefon, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( Firma_Telefax <> "" )DrawText("Telefax:", links1, hoehe, links2 - links1, 50)DrawText(Firma_Telefax, links2, hoehe, breite, 50)set hoehe to hoehe + zabendifif ( Firma_Email <> "" )DrawText("E-Mail:", links1, hoehe, links2 - links1, 50)DrawText(Firma_Email, links2, hoehe, breite, 100)set hoehe to hoehe + 2 * zabendifDrawText("Seite:", links1, hoehe, links2 - links1, 50)DrawText(NumToText(PAGE_NUMBER), links2, hoehe, breite, 50)' -----------------------------------------------------------------------------------------' Anschreiben' -----------------------------------------------------------------------------------------#BeginGraphicsTextSetArea(1500, AREA_AUTOSIZE)#include "STYLE Arial 9, normal"' Titelset hoehe to 100set links1 to LAYOUTLEFTSetTextSize(11)SetTextBold(true)DrawText(mahntitel, links1, hoehe, LAYOUTWIDTH, 50)SetTextBold(false)SetTextSize(9)set hoehe to hoehe + 80' AnschreibenDrawText("Sehr geehrte Damen und Herren,", links1, hoehe, LAYOUTWIDTH, 50)set hoehe to hoehe + 80DrawText(mahntext1, links1, hoehe, LAYOUTWIDTH, 1160)set hoehe to hoehe + 80' -----------------------------------------------------------------------------------------' Positionen' -----------------------------------------------------------------------------------------#BeginTableHeaderSetArea(110)#include "STYLE Arial 7, normal"set hoehe to 40set zab to 30' SpaltenkopfDrawText("Beleg-Nr.", l1, hoehe + zab, b1, 40)DrawText("Datum", l2, hoehe + zab, b2, 40)DrawText("Fällig", l3, hoehe + zab, b3, 40)DrawText("Mahn-", l4, hoehe, b4, zab, ALIGN_CENTER)DrawText("stufe", l4, hoehe + zab, b4, 40, ALIGN_CENTER)DrawText("Betrag der Rechnung" + aw, l5, hoehe, b5, 80, ALIGN_RIGHT)DrawText("davon noch Offen" + aw, l6, hoehe, b6, 80, ALIGN_RIGHT)DrawText("Gebühren" + aw, l7, hoehe + zab, b7, 40, ALIGN_RIGHT)DrawText("Zinsen" + aw, l8, hoehe + zab, b8, 40, ALIGN_RIGHT)DrawText("Gesamt" + aw, l9, hoehe + zab, b9, 40, ALIGN_RIGHT)DrawLine(s1, hoehe + 2*zab + 10, s10, hoehe + 2*zab + 10)SetCurrentTable("Offene Posten")' -----------------------------------------------------------------------------------------' Der Bereich 'TabelRow' wird für jede Position einmal wiederholt#BeginTableRowSetArea(100, AREA_AUTOSIZE)#include "STYLE Arial 8, normal"set hoehe to 10if (ALT_ZEILENHINTERGRUND)SetFillColor(RGBColor(230, 230, 230))set row to row + 1if ( Mod(row, 2) = 1 )FillAreaVertical(LAYOUTLEFT, LAYOUTLEFT + LAYOUTWIDTH)endifendifDrawText(MA_RechnungsNr, l1, hoehe, b1, 90)DrawText(IfThen(GetPlatform = 1, MediumDate(MA_RechnungDatum), ShortDate(MA_RechnungDatum)), l2, hoehe, b2, 40)DrawText(IfThen(GetPlatform = 1, MediumDate(MA_Faellig), ShortDate(MA_Faellig)), l3, hoehe, b3, 40)DrawText(Format(MA_Mahnstufe, "#;#;"), l4, hoehe, b4, 40, ALIGN_CENTER)DrawText(Format(MA_BetragRechnung, FORMATBETRAGNULL), l5, hoehe, b5, 40, ALIGN_RIGHT)DrawText(Format(MA_BetragOffen, FORMATBETRAGNULL), l6, hoehe, b6, 40, ALIGN_RIGHT)DrawText(Format(MA_BetragGebuehren, FORMATBETRAGNULL), l7, hoehe, b7, 40, ALIGN_RIGHT)DrawText(Format(MA_BetragZinsen, FORMATBETRAGNULL), l8, hoehe, b8, 40, ALIGN_RIGHT)DrawText(Format(MA_BetragGesamt, FORMATBETRAGNULL), l9, hoehe, b9, 40, ALIGN_RIGHT)set gesamt to gesamt + MA_BetragGesamt'Platzhalter für MindesthöheSetLineColor(WHITE)DrawRect(0, 0, 10, 45)SetLineColor(BLACK)' -----------------------------------------------------------------------------------------' Abschließende Linie und Gesamtsumme nach der letzten Position der Tabelle#BeginTableFooterSetArea(100)#include "STYLE Arial 8, normal"DrawLine(s1, 0, s10, 0)set hoehe to 10SetTextBold(true)DrawText("Gesamt:", l8, hoehe, b8, 40, ALIGN_RIGHT)DrawText(Format(gesamt, FORMATBETRAGNULL), l9, hoehe, b9, 40, ALIGN_RIGHT)' -----------------------------------------------------------------------------------------' Schlusstext' -----------------------------------------------------------------------------------------#BeginGraphicsTextSetArea(1500, AREA_AUTOSIZE)#include "STYLE Arial 9, normal"set links1 to LAYOUTLEFTset hoehe to 40if ( CountFields(mahntext2, "#StichtagDatum#") > 0 )set mahntext2 to ReplaceAll(mahntext2, "#StichtagDatum#", IfThen(GetPlatform = 1, MediumDate(FILTER_Stichtag), ShortDate(FILTER_Stichtag)))endifDrawText(mahntext2, links1, hoehe, LAYOUTWIDTH, 1160)' -----------------------------------------------------------------------------------------' Beginn Fusszeile (Platzhalter)' -----------------------------------------------------------------------------------------#BeginFooterSetArea(FOOTER_HEIGHT)' Dummy-Zeichenbefehl (unsichtbar): Ohne Ausgabe wird die Bereichshöhe nicht gesetztDrawLine(0, 0, 0, 0)0000011